---
title: "Spline Knot Estimation"
author: "He Junhui"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(EBARS)
library(splines)
library(segmented)
source("bars.R")
source("Linear_Spline_Estimation.R")
```


```{r}
f1 = function(x) {
  knots = c(0.5)
  beta = c(1,-2,1)
  B = bs(x,knots=knots,degree=1,intercept=TRUE,Boundary.knots=c(0,1))
  y = B%*%beta
  return(y)
}

f2 = function(x) {
  knots = c(0.3,0.7)
  beta = c(1,-1,1,-1)
  B = bs(x,knots=knots,degree=1,intercept=TRUE,Boundary.knots=c(0,1))
  y = B%*%beta
  return(y)
}

f3 = function(x) {
  knots = c(0.2,0.2,0.5,0.7)
  beta = c(1,-1,1,-1,1,-1)
  B = bs(x,knots=knots,degree=1,intercept=TRUE,Boundary.knots=c(0,1))
  y = B%*%beta
  return(y)
}
```

```{r}
set.seed(1234)
```

```{r}
k = 2
m_train = 200; noise = 0.2
x_train = runif(m_train)
y_train = f2(x_train)
y_obs = y_train + rnorm(m_train,0,noise)
```

```{r}
idx = order(x_train)
plot(x_train,y_obs,col="red",cex=0.5,pch=16,xlab="",ylab="")
points(x_train[idx],y_train[idx],type="l",lwd=1.5)
```

```{r}
# Linear Spline Estimation
xi_lse = LSE(x_train,y_obs,runif(k))
print(sort(xi_lse))
```

```{r}
# EBARS
ebars_linear = ebars(x_train,y_obs,k=k,n=500,degree=1,intercept=TRUE)
ebars_linear$mcmc(burns=1000,steps=1000)
xi_ebars = sort(ebars_linear$knots())
print(xi_ebars)
```

```{r}
# segmented method
fit.lm = lm(y_obs~x_train)
fit.seg = segmented(fit.lm,seg.Z=~x_train,psi=runif(k))
xi_seg = sort(fit.seg$psi[,2])
print(xi_seg)
```

